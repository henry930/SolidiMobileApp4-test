appId: co.solidi.mobile.test
---
# Address Book - Destination Address Test (No Launch - Manual Start)
# Tests the fix: "Address Book - Destination - Should not check the length of the asset - should check address"
# NOTE: Launch the app manually before running this test

# Wait for app to be ready
- extendedWaitUntil:
    visible: ".*"
    timeout: 10000
- takeScreenshot: 01_app_ready

# Check if we need to login
- runFlow:
    when:
      visible: "Secure Login|Sign In"
    commands:
      - takeScreenshot: 01a_login_required
      - tapOn: "Email Address"
      - inputText: "henry930@gmail.com"
      - hideKeyboard
      - tapOn: "Password"
      - inputText: "DazzPow/930"
      - hideKeyboard
      - tapOn: "SIGN IN"
      - extendedWaitUntil:
          visible: "Wallet|Transfer|History"
          timeout: 20000
      - takeScreenshot: 01b_logged_in

# Navigate to Settings via Header Button (Top Right)
- tapOn:
    id: "header-settings-button"
- takeScreenshot: 02_settings_button_tapped

# Verify we are on Settings page
- extendedWaitUntil:
    visible: "Wallet & Finance|Account Settings|Personal Details"
    timeout: 10000
- takeScreenshot: 03_settings_page_confirmed

# Scroll until Address Book is visible (using testID)
# Scroll to the bottom to find Address Book
- scrollUntilVisible:
    element:
      id: "settings-address-book-item"
    direction: DOWN
    timeout: 10000
    speed: 80
    visibilityPercentage: 100
- takeScreenshot: 04_scrolled_to_bottom_address_book

# Tap Address Book
- tapOn:
    id: "settings-address-book-item"
- takeScreenshot: 05_address_book_tapped

# Verify we are on the Address Book page using the root anchor
- extendedWaitUntil:
    visible:
      id: "address-book-root"
    timeout: 10000
- takeScreenshot: 05a_address_book_root_found

# Handle Loading State (if root is not immediately visible or if loading overlay is present)
- runFlow:
    when:
      visible:
        id: "address-book-loading"
    commands:
      - takeScreenshot: 05b_loading
      - extendedWaitUntil:
          notVisible:
            id: "address-book-loading"
          timeout: 60000

# Handle Error State
- runFlow:
    when:
      visible:
        id: "address-book-error"
    commands:
      - takeScreenshot: 05c_error
      - tapOn: "Retry"
      - extendedWaitUntil:
          notVisible:
            id: "address-book-error"
          timeout: 20000

# Now look for the "Add Address" tab
- extendedWaitUntil:
    visible:
      id: "address-book-add-tab"
    timeout: 10000
- tapOn:
    id: "address-book-add-tab"
- takeScreenshot: 06_add_address_tab_selected

# Verify form appeared, if not retry tap
- runFlow:
    when:
      notVisible:
        id: "address-book-form-step-1"
    commands:
      - tapOn:
          id: "address-book-add-tab"
      - extendedWaitUntil:
          visible:
            id: "address-book-form-step-1"
          timeout: 10000

# Now look for the form content
- extendedWaitUntil:
    visible:
      id: "recipient-option-another_person"
    timeout: 10000
- takeScreenshot: 07_recipient_selection

# Step 1: Select recipient type - "Myself"
- extendedWaitUntil:
    visible:
      id: "recipient-option-myself"
    timeout: 10000
- tapOn:
    id: "recipient-option-myself"
- takeScreenshot: 08_recipient_selected

# Scroll down to find Next button
- scrollUntilVisible:
    element:
      id: "button-next"
    direction: DOWN
    timeout: 5000
    speed: 40
    visibilityPercentage: 100

# Click Next/Continue
- runFlow:
    when:
      visible:
        id: "button-next"
    commands:
      - tapOn:
          id: "button-next"
      - takeScreenshot: 08a_next_tapped
      - extendedWaitUntil:
          visible:
            id: "address-book-form-step-2"
          timeout: 10000

# Step 2: Verify auto-filled details
- extendedWaitUntil:
    visible:
      id: "address-book-form-step-2"
    timeout: 10000
- takeScreenshot: 09_details_step_autofilled

# Fields should be auto-filled for "Myself", just verify they exist
- extendedWaitUntil:
    visible:
      id: "input-firstname"
    timeout: 5000
- extendedWaitUntil:
    visible:
      id: "input-lastname"
    timeout: 5000
- takeScreenshot: 10_details_verified

# Click Next
- runFlow:
    when:
      visible:
        id: "button-next"
    commands:
      - tapOn:
          id: "button-next"
      - extendedWaitUntil:
          visible:
            id: "address-book-form-step-3"
          timeout: 3000

# Step 3: Select Asset - BTC
- takeScreenshot: 11_asset_selection

- tapOn:
    id: "asset-option-btc"
- takeScreenshot: 12_btc_selected

# Click Next
- runFlow:
    when:
      visible:
        id: "button-next"
    commands:
      - tapOn:
          id: "button-next"
      - extendedWaitUntil:
          visible:
            id: "address-book-form-step-4-crypto"
          timeout: 3000

# Step 4: Enter Destination Address (THIS IS THE KEY STEP)
- takeScreenshot: 13_destination_step

# Enter a valid BTC address
- tapOn:
    id: "input-withdrawal-address"
- inputText: "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa"
- hideKeyboard
- takeScreenshot: 14_full_address_entered

# Click Submit
- scrollUntilVisible:
    element:
      id: "button-submit"
    direction: DOWN
    timeout: 5000
- tapOn:
    id: "button-submit"
- takeScreenshot: 15_submit_clicked

# Verify Success
- extendedWaitUntil:
    visible: "Address Added Successfully! âœ…"
    timeout: 10000
- takeScreenshot: 16_success_alert

# Try to proceed - this should SUCCEED now (previously failed)
- runFlow:
    when:
      visible: "Next|Continue"
    commands:
      - tapOn: "Next|Continue"
      - extendedWaitUntil:
          visible: "Personal|Exchange|Summary"
          timeout: 5000
      - takeScreenshot: 15_success_next_step

# Final verification
- takeScreenshot: 16_test_complete
