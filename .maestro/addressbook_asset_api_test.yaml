appId: co.solidi.mobile.test
---
# Test: Address Book Asset List API Integration
# Verifies that asset list loads from /v1/balances API instead of hardcoded fallback

# Wait for app to be ready
- assertVisible: ".*"
- takeScreenshot: 01_app_ready

# Handle login if needed
- runFlow:
    when:
      visible: "Secure Login|Sign In"
    commands:
      - tapOn: "Secure Login|Sign In"
      - extendedWaitUntil:
          notVisible: "Secure Login|Sign In"
          timeout: 10000

# Navigate to Settings
- tapOn:
    id: "header-settings-button"
- extendedWaitUntil:
    visible: "Wallet & Finance|Account Settings|Personal Details"
    timeout: 10000
- takeScreenshot: 02_settings_page

# Scroll to Address Book - scroll down to bottom of settings
- scroll
- scroll
- takeScreenshot: 03_scrolled_down

# Find Address Book item
- extendedWaitUntil:
    visible:
      id: "settings-address-book-item"
    timeout: 5000
- takeScreenshot: 03_address_book_visible

# Tap Address Book
- tapOn:
    id: "settings-address-book-item"
- extendedWaitUntil:
    visible:
      id: "address-book-root"
    timeout: 10000
- takeScreenshot: 04_address_book_page

# Tap Add Address tab
- tapOn:
    id: "address-book-add-tab"
- extendedWaitUntil:
    visible:
      id: "address-book-form-step-1"
    timeout: 5000
- takeScreenshot: 05_add_address_form

# Select Myself
- tapOn:
    id: "recipient-option-myself"
- scrollUntilVisible:
    element:
      id: "button-next"
    direction: DOWN
    timeout: 5000
- tapOn:
    id: "button-next"

# Step 2: Auto-filled details - just click Next
- extendedWaitUntil:
    visible:
      id: "address-book-form-step-2"
    timeout: 5000
- scrollUntilVisible:
    element:
      id: "button-next"
    direction: DOWN
    timeout: 5000
- tapOn:
    id: "button-next"

# Step 3: Asset selection - THIS IS THE CRITICAL STEP
- extendedWaitUntil:
    visible:
      id: "address-book-form-step-3"
    timeout: 5000
- takeScreenshot: 06_asset_list_from_api

# Test search functionality if it exists (> 6 assets)
- runFlow:
    when:
      visible:
        id: "asset-search-input"
    commands:
      - takeScreenshot: 07_search_input_visible
      - tapOn:
          id: "asset-search-input"
      - inputText: "BTC"
      - takeScreenshot: 08_search_filtered_btc
      
      # Verify BTC is visible after search
      - assertVisible:
          id: "asset-option-btc"
      
      # Clear search to show all assets again
      - tapOn:
          id: "asset-search-input"
      - eraseText
      - hideKeyboard
      - takeScreenshot: 09_search_cleared

# Verify at least one asset option exists
# This confirms assets are loaded (either from API or fallback)
- assertVisible:
    id: "asset-option-.*"

# SUCCESS: Asset list is displayed
- takeScreenshot: 10_test_complete
